machine:
  services:
    - docker

dependencies:
  override:
    - docker build --force-rm --no-cache --pull -t experimentalplatform/ubuntu:$CIRCLE_BRANCH .

test:
  override:
    - "echo 'TODO: Insert some tests here?'"

#deployment:
#  latest:
#    branch: latest
#    commands:
#      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
#      - docker push experimentalplatform/ubuntu:$CIRCLE_BRANCH
#      - |
#        if [[ ${TRIGGER} == "true" ]]; then
#          for project in platform_app_manager platform-central-gateway platform_configure platform_dokku platform_frontend platform_hostname_avahi platform_hostname_smb platform_monitoring platform-ptw platform_skvs platform_systemd_proxy; do
#            echo "URL: https://circleci.com/api/v1/project/experimental-platform/$(sed s/_/-/g <<< ${project})/tree/development?circle-token=${!project}"
#            curl -f --header "Content-Type: application/json" \
#            --data "{\"build_parameters\": {\"TRIGGER\": true}}" --request POST \
#            "https://circleci.com/api/v1/project/experimental-platform/$(sed s/_/-/g <<< ${project})/tree/development?circle-token=${!project}"
#          done
#        fi
# CircleCI does not accept dashes in variable names so we replace them with underscores
